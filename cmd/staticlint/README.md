# Staticlint - комплексный статический анализатор для проекта Shortener

## Установка и запуск

1. Установите инструмент:
```bash
go install github.com/ryabkov82/shortener/cmd/staticlint@latest
```

2. Запустите проверку:
```bash
staticlint ./...
```

Или можно запустить без установки:
```bash
go run cmd/staticlint/main.go ./...
```

## Включенные анализаторы

### Стандартные анализаторы Go

- **asmdecl** - проверяет корректность объявлений ассемблерного кода
- **assign** - обнаруживает бесполезные присваивания
- **atomic** - проверяет правильность использования sync/atomic
- **bools** - обнаруживает распространенные ошибки с булевыми операторами
- **buildtag** - проверяет корректность build тегов
- **cgocall** - проверяет корректность вызовов CGO
- **composite** - проверяет композитные литералы без ключей
- **copylock** - проверяет копирование мьютексов
- **deepequalerrors** - проверяет использование deep equal с ошибками
- **errorsas** - проверяет правильность использования errors.As
- **fieldalignment** - предлагает оптимальное выравнивание полей структур
- **httpresponse** - проверяет закрытие HTTP response bodies
- **ifaceassert** - обнаруживает бессмысленные type assertions
- **loopclosure** - проверяет захват переменных в замыканиях
- **lostcancel** - проверяет утечку контекста
- **nilfunc** - обнаруживает сравнения функций с nil
- **printf** - проверяет формат строки в Printf-функциях
- **shadow** - обнаруживает затенение переменных
- **shift** - проверяет сдвиги превышающие размер типа
- **sigchanyzer** - проверяет неправильное использование каналов в signal.Notify
- **stdmethods** - проверяет соответствие стандартным интерфейсам
- **structtag** - проверяет корректность тегов структур
- **testinggoroutine** - обнаруживает утечку горутин в тестах
- **unmarshal** - проверяет правильность передачи указателей в Unmarshal
- **unreachable** - обнаруживает недостижимый код
- **unsafeptr** - проверяет корректность преобразований unsafe.Pointer
- **unusedresult** - проверяет неиспользованные результаты функций

### Анализаторы Staticcheck (SA класс)

Включает все анализаторы класса SA (Static Analysis) из staticcheck.io, которые обнаруживают:

- Неправильное использование API
- Потенциальные ошибки в работе с памятью
- Проблемы конкурентности
- Подозрительные конструкции кода
- Возможные утечки ресурсов

### Другие анализаторы Staticcheck

- **ST1000** - проверка документации пакета
- **S1002** - предлагает упрощение булевых выражений
- **QF1001** - применяет законы Де Моргана

### Сторонние анализаторы

- **bodyclose** - проверяет закрытие response.Body в HTTP-запросах
- **go-critic** - выявляет потенциальные ошибки, неэффективности и плохие практики программирования

### Собственные анализаторы

### noosexit

Запрещает прямой вызов `os.Exit()` в функции `main()` пакета `main`.

**Почему это важно:**
- Прямой вызов `os.Exit()` препятствует:
  - Корректному завершению работы (не вызываются defer)
  - Тестированию main-функции
  - Гибкой обработке ошибок

**Что использовать вместо:**
- Для фатальных ошибок: `log.Fatal()`
- Для graceful shutdown: возврат ошибки из функции и обработка в main()

**Пример неправильного кода:**
```go
func main() {
    os.Exit(1) // запрещено!
}
```

**Пример правильного кода:**
```go
func run() error {
    // логика приложения
    return errors.New("error")
}

func main() {
    if err := run(); err != nil {
        log.Fatal(err)
    }
}

## Интеграция с CI/CD

Добавьте в ваш CI-скрипт:
```bash
go run cmd/staticlint/main.go ./...
```

Или используйте предустановленную версию:
```bash
staticlint ./...
```